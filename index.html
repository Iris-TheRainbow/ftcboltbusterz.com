<!doctype html>
<html lang="en-US">
    <head> 
        <link rel="stylesheet" href="styles.css">
        <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
        <script src="scripts/elements.js"></script>
        <script lang="js">
            const competing = ({ location, name }, slot) => `Null Pointer Exception is competing ${slot} in <b>${location.city}</b> for <b>${name}</b>`
            const competingToday = event => competing(event, "<b>today</b>")
            const competingLater = (event, days) => competing(event, `<b>in ${days} days</b>`)

            async function getEvents() {
                await axios.post("https://api.ftcscout.org/graphql", {
                    query: `{
                        teamByNumber(number: 27971){
                            events(season: 2024){
                                event{
                                    name
                                    location{
                                        city
                                    }
                                    start
                                }
                            }
                        }
                    }`
                })
                    .then(response => {
                        const specificDate = new Date();

                        const events = response.data.data.teamByNumber.events;
                        const dates = events
                            .map(it => it.event)
                            .map(it => new Date(it.start.replace(/-/g, "/")))
                            .filter(it => specificDate <= it)
                            
                        document.getElementById("time").innerHTML = "Null Pointer Exception have competed in all of their events this season";
                        if (dates.length > 0){
                            const target = dates.reduce((a, b) => a < b ? a : b)


                            if (dates.length === 0)      { console.log("all events completed") }
                            if (specificDate === target) { console.log("event today!") }
                            if (specificDate < target)   { console.log("event is in the future") }
                            const sorted = events
                                .map(it => ({
                                    event: it.event,
                                    date: new Date(it.event.start),
                                    days: Math.round(((new Date(it.event.start.replace(/-/g, "/"))) - specificDate) / (1000 * 60 * 60 * 24))
                                }))
                                .filter(it => it.days > 0)
                                .sort((a, b) => a.days - b.days)
                                .map(it => {
                                    const { date, event, days } = it
                                    if (date < target) return competingLater(event, days)
                                    if (date === target) return competingToday(event)
                                    if (date > target) return competingLater(event, days)
                                    else return competingLater(event, days)
                                })
                                .filter(it => it !== null)
                            document.getElementById("time").innerHTML = sorted[0];
                        }
                    })
            }
        </script>
        <script lang="js">
            async function getOpr() {
                await axios.post("https://api.ftcscout.org/graphql", {
                    query: `{
                    teamByNumber(number: 27971){
                        quickStats(season: 2023){
                        tot{
                            value
                        }
                        }
                    }
                    }`
                })
                    .then(response => {
                        document.title = "Opr: " +Math.round(response.data.data.teamByNumber.quickStats.tot.value * 100)/100
                    })
                }
        </script>
        <link rel="stylesheet" href="styles.css">
        <script src="scripts/elements.js"></script>
        <link rel="icon" type="image/png" href="/favicons/favicon-48x48.png" sizes="48x48" />
        <link rel="icon" type="image/svg+xml" href="/favicons/favicon.svg" />
        <link rel="shortcut icon" href="/favicons/favicon.ico" />
        <link rel="apple-touch-icon" sizes="180x180" href="/favicons/apple-touch-icon.png" />
        <meta name="apple-mobile-web-app-title" content="FTC-NPE" />
        <link rel="manifest" href="/favicons/site.webmanifest" />
    </head>

    <body onload="getEvents(); getOpr(); generateElements()">
        <span id="headder"></span>
        <div style="display: flex; justify-content: center;">
            <div class="center">
                <h1>
                    FTC Null Pointer Exception
                </h1>
                <p>
                    Hello! Welcome to FTC Null Pointer Exception!
                    <br><br>
                    We are a robotics team from <b>Paxton, Illinois</b> 
                    and are a member of <b>Illinois Central</b> league.
                    <br> 
                    We have a passion for robotcs and FTC as a whole and want to do our absolute best to improve the FTC community
                    <br><br>
                    <span id="time"></span>
                    <br><br>
                    Our outreach efforts include work on Unofficial REV Port and outreach within our area, showing off FTC to our community. More info can be found <a href="outreach.html">here</a>.
                    <br><br>
                    We are a team formed from ex members of team 15031, BoltBusterZ. After our school district did not register our team, we still wanted to compete, so we decided to start a new, community team!
                    <br><br>
                    Our yearly robots and prior robots from 15031 can be found <a href="robots.html">here</a>!
                </p>
            </div>
        </div>
        <div>
            <span id="footer"></span>
        </div>
    </body> 
</html>
